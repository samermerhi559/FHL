<section class="space-y-6">
  <div class="grid gap-4 lg:grid-cols-3">
    <div class="rounded-2xl border border-border bg-card p-4 shadow-card">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-muted-foreground">Current Context</p>
          <h2 class="text-lg font-semibold">Executive Overview</h2>
        </div>
        <lucide-icon name="LayoutDashboard" class="h-5 w-5 text-primary" />
      </div>
      <dl class="mt-4 space-y-2 text-sm">
        <div class="flex justify-between">
          <dt class="text-muted-foreground">Tenant</dt>
          <dd class="font-medium">
            {{ state.filters().tenant?.name ?? 'Not Selected' }}
          </dd>
        </div>
        <div class="flex justify-between">
          <dt class="text-muted-foreground">Entity</dt>
          <dd class="font-medium">
            {{ state.filters().entity?.name ?? 'All' }}
          </dd>
        </div>
        <div class="flex justify-between">
          <dt class="text-muted-foreground">Period</dt>
          <dd class="font-medium">{{ state.filters().period.label }}</dd>
        </div>
      </dl>
      <div class="mt-4 rounded-lg bg-muted p-3 text-xs text-muted-foreground">
        Right-click anywhere to copy direct deep links with filters applied.
      </div>
    </div>

    <div class="rounded-2xl border border-border bg-card p-4 shadow-card">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-muted-foreground">Signals</p>
          <h2 class="text-lg font-semibold">Headlines</h2>
        </div>
        <lucide-icon name="Bell" class="h-5 w-5 text-primary" />
      </div>
      <ul class="mt-4 space-y-3 text-sm">
        @for (headline of headlines; track headline.label) {
          <li class="flex items-center justify-between rounded-lg border border-dashed border-border px-3 py-2">
            <div>
              <p class="text-muted-foreground">{{ headline.label }}</p>
              <p class="font-semibold">{{ headline.value }}</p>
            </div>
            <lucide-icon
              [name]="headline.trend === 'down' ? 'ArrowDown' : 'ArrowUp'"
              class="h-4 w-4"
              [class.text-emerald-500]="headline.trend === 'up'"
              [class.text-red-500]="headline.trend === 'down'"
            />
          </li>
        }
      </ul>
    </div>

    <div class="rounded-2xl border border-border bg-card p-4 shadow-card">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-muted-foreground">Open Alerts</p>
          <h2 class="text-lg font-semibold">
            {{ state.unreadAlerts() }} awaiting review
          </h2>
        </div>
        <button
          type="button"
          class="rounded-full border border-border px-3 py-1 text-xs font-medium transition hover:bg-muted"
          (click)="navigateToSection('alerts')"
        >
          View all
        </button>
      </div>
      <ul class="mt-4 space-y-3 text-sm">
        @for (alert of alerts | slice:0:3; track alert.id) {
          <li class="cursor-pointer rounded-lg border border-border/60 p-3 hover:border-border" (click)="navigateToSection(alert.section)">
            <div class="flex items-center justify-between">
              <span
                class="rounded-full px-2 py-0.5 text-xs font-medium"
                [class.bg-red-50]="alert.severity === 'high'"
                [class.text-red-600]="alert.severity === 'high'"
                [class.bg-amber-50]="alert.severity === 'medium'"
                [class.text-amber-600]="alert.severity === 'medium'"
                [class.bg-blue-50]="alert.severity === 'low'"
                [class.text-blue-600]="alert.severity === 'low'"
              >
                {{ alert.severity | titlecase }}
              </span>
              <span class="text-xs text-muted-foreground">
                {{ alert.timestamp | date: 'shortTime' }}
              </span>
            </div>
            <p class="mt-2 font-medium">{{ alert.title }}</p>
            <p class="text-xs text-muted-foreground">
              {{ alert.description }}
            </p>
          </li>
        }
      </ul>
    </div>
  </div>

  <div class="grid gap-4 lg:grid-cols-2">
    <div class="rounded-2xl border border-border bg-card p-4 shadow-card">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-muted-foreground">Accounts Receivable</p>
          <h2 class="text-lg font-semibold">Collection Efficiency</h2>
        </div>
        <span class="text-xs text-muted-foreground">
          @if (arState().loading) {
            Loading...
          } @else if (arState().error) {
            Error
          } @else {
            Synced
          }
        </span>
      </div>

      <div class="mt-4 flex flex-wrap gap-2 text-xs">
        <span class="rounded-full border px-3 py-1 font-medium" [ngClass]="statusClasses[arSection()?.status ?? 'healthy']">
          {{ arSection()?.status | titlecase }}
        </span>
        @if (arSection()?.statusReason) {
          <span class="rounded-full bg-muted px-3 py-1 text-muted-foreground">
            {{ arSection()?.statusReason }}
          </span>
        }
      </div>

      <div class="mt-4 grid gap-4 sm:grid-cols-2">
        @for (kpi of arSection()?.kpis ?? []; track kpi.label) {
          <div class="rounded-xl border border-border/70 p-3">
            <p class="text-xs text-muted-foreground">{{ kpi.label }}</p>
            <p class="text-xl font-semibold">{{ kpi.value }}</p>
            @if (kpi.change !== undefined) {
              <p class="mt-1 text-xs" [class.text-emerald-600]="kpi.trend === 'up'" [class.text-red-600]="kpi.trend === 'down'">
                <lucide-icon
                  [name]="kpi.trend === 'down' ? 'ArrowDown' : 'ArrowUp'"
                  class="mr-1 inline h-3 w-3"
                />
                {{ kpi.change }}%
              </p>
            }
          </div>
        }
      </div>

      @if (arState().error) {
        <p class="mt-4 rounded-lg bg-red-50 p-3 text-sm text-red-600">
          {{ arState().error }}
        </p>
      }
    </div>

    <div class="rounded-2xl border border-border bg-card p-4 shadow-card">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-muted-foreground">Accounts Payable</p>
          <h2 class="text-lg font-semibold">Disbursement Health</h2>
        </div>
        <span class="text-xs text-muted-foreground">
          @if (apState().loading) {
            Loading...
          } @else if (apState().error) {
            Error
          } @else {
            Synced
          }
        </span>
      </div>

      <div class="mt-4 flex flex-wrap gap-2 text-xs">
        <span class="rounded-full border px-3 py-1 font-medium" [ngClass]="statusClasses[apSection()?.status ?? 'healthy']">
          {{ apSection()?.status | titlecase }}
        </span>
        @if (apSection()?.statusReason) {
          <span class="rounded-full bg-muted px-3 py-1 text-muted-foreground">
            {{ apSection()?.statusReason }}
          </span>
        }
      </div>

      <div class="mt-4 grid gap-4 sm:grid-cols-2">
        @for (kpi of apSection()?.kpis ?? []; track kpi.label) {
          <div class="rounded-xl border border-border/70 p-3">
            <p class="text-xs text-muted-foreground">{{ kpi.label }}</p>
            <p class="text-xl font-semibold">{{ kpi.value }}</p>
            @if (kpi.change !== undefined) {
              <p class="mt-1 text-xs" [class.text-emerald-600]="kpi.trend === 'up'" [class.text-red-600]="kpi.trend === 'down'">
                <lucide-icon
                  [name]="kpi.trend === 'down' ? 'ArrowDown' : 'ArrowUp'"
                  class="mr-1 inline h-3 w-3"
                />
                {{ kpi.change }}%
              </p>
            }
          </div>
        }
      </div>

      @if (apState().error) {
        <p class="mt-4 rounded-lg bg-red-50 p-3 text-sm text-red-600">
          {{ apState().error }}
        </p>
      }
    </div>
  </div>

  <div class="grid gap-4 xl:grid-cols-3">
    <div class="rounded-2xl border border-border bg-card p-4 shadow-card">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-muted-foreground">Cash Projection</p>
          <h2 class="text-lg font-semibold">13-Week Outlook</h2>
        </div>
        <span class="text-xs text-muted-foreground">USD (millions)</span>
      </div>
      <div class="mt-4 space-y-2 text-sm">
        @for (point of cashTrend; track point.week) {
          <div class="flex items-center justify-between rounded border border-dashed border-border px-3 py-2">
            <span class="text-muted-foreground">{{ point.week }}</span>
            <span class="font-medium">
              {{ point.actual ?? point.projected }}M
              <span class="text-xs text-muted-foreground">
                {{ point.actual ? 'actual' : 'projected' }}
              </span>
            </span>
          </div>
        }
      </div>
    </div>

    <div class="rounded-2xl border border-border bg-card p-4 shadow-card">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-muted-foreground">AI Insights</p>
          <h2 class="text-lg font-semibold">Explainability</h2>
        </div>
        <lucide-icon name="Sparkles" class="h-5 w-5 text-primary" />
      </div>
      <p class="mt-4 text-sm text-muted-foreground">
        Enable AI Explain to receive contextual narratives, root-cause analysis, and sharing
        controls directly in the workspace. Insights adapt to the filters you set above.
      </p>
      <button
        type="button"
        class="mt-4 w-full rounded-lg border border-border px-4 py-2 text-sm font-medium transition hover:bg-muted"
        (click)="state.toggleAiInsights()"
      >
        {{ state.aiEnabled() ? 'Disable' : 'Enable' }} AI Explain
      </button>
    </div>

    <div class="rounded-2xl border border-border bg-card p-4 shadow-card">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-muted-foreground">Quick Links</p>
          <h2 class="text-lg font-semibold">Deep Dives</h2>
        </div>
        <lucide-icon name="ChevronRight" class="h-5 w-5 text-primary" />
      </div>
      <ul class="mt-4 space-y-2 text-sm">
        <li
          class="flex cursor-pointer items-center justify-between rounded-lg border border-border px-3 py-2 hover:bg-muted"
          (click)="navigateToSection('ar')"
        >
          <span>Overdue invoices</span>
          <lucide-icon name="ArrowRight" class="h-4 w-4" />
        </li>
        <li
          class="flex cursor-pointer items-center justify-between rounded-lg border border-border px-3 py-2 hover:bg-muted"
          (click)="navigateToSection('fx-treasury')"
        >
          <span>FX exposure</span>
          <lucide-icon name="ArrowRight" class="h-4 w-4" />
        </li>
        <li
          class="flex cursor-pointer items-center justify-between rounded-lg border border-border px-3 py-2 hover:bg-muted"
          (click)="navigateToSection('concentration-risk')"
        >
          <span>Concentration limits</span>
          <lucide-icon name="ArrowRight" class="h-4 w-4" />
        </li>
      </ul>
    </div>
  </div>

  <div class="grid gap-4 lg:grid-cols-2 2xl:grid-cols-3">
    @for (section of computedSections(); track section.id) {
      <article
        class="flex cursor-pointer flex-col rounded-2xl border border-border bg-card p-4 shadow-card transition hover:border-primary"
        (click)="navigateToSection(section.id)"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-muted-foreground">{{ section.name }}</p>
            <h3 class="text-xl font-semibold">
              {{ section.kpis.length ? section.kpis[0].value : '--' }}
            </h3>
          </div>
          <span
            class="rounded-full border px-3 py-1 text-xs font-medium"
            [ngClass]="statusClasses[section.status]"
          >
            {{ section.status | titlecase }}
          </span>
        </div>
        <div class="mt-4 grid gap-3 text-sm text-muted-foreground">
          @for (kpi of section.kpis; track kpi.label) {
            <div class="flex items-center justify-between">
              <span>{{ kpi.label }}</span>
              <span class="font-semibold text-foreground">{{ kpi.value }}</span>
            </div>
          }
        </div>
        @if (section.sparklineData?.length) {
          <div class="mt-4">
            <app-sparkline [data]="section.sparklineData!" />
          </div>
        }
      </article>
    }
  </div>
</section>
